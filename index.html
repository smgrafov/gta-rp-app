<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>GTA RP | BOOMBAHA Ledger</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
    <style>
        :root {
            --bg: #0b0b0e;
            --card-bg: #16161d;
            --accent: #ff9f0a;
            --success: #30d158;
            --danger: #ff453a;
            --youtube: #ff0000;
            --text-main: #ffffff;
            --text-secondary: #8e8e93;
        }

        body { 
            margin:0; font-family: -apple-system, system-ui, sans-serif;
            background: var(--bg); color: var(--text-main); 
            user-select: none; -webkit-tap-highlight-color: transparent;
        }

        header { 
            padding: 15px; background: var(--card-bg); 
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .header-btn {
            border: none; padding: 7px 12px; border-radius: 8px;
            font-weight: bold; font-size: 11px; cursor: pointer;
            text-decoration: none; display: inline-flex; align-items: center;
        }

        .container { padding: 15px; padding-bottom: 50px; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-card { background: var(--card-bg); padding: 15px; border-radius: 14px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .stat-card small { font-size: 10px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-card div { font-size: 18px; font-weight: 800; margin-top: 5px; }

        /* –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é */
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .cat-card { 
            background: var(--card-bg); border-radius: 16px; padding: 20px; 
            text-align: center; border: 1px solid rgba(255,255,255,0.02);
            transition: 0.2s;
        }
        .cat-card:active { transform: scale(0.95); background: #1c1c26; }
        .journal-btn { background: #24242f; color: #fff; padding: 15px; border-radius: 14px; text-align: center; margin: 15px 0; font-weight: 600; cursor: pointer; }

        /* –°–ø–∏—Å–æ–∫ —Å–¥–µ–ª–æ–∫ */
        .deal-item { 
            background: var(--card-bg); padding: 14px; border-radius: 12px; 
            margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;
            border-left: 4px solid var(--accent);
        }
        .deal-item .info b { font-size: 15px; }
        .deal-item .info small { color: var(--text-secondary); display: block; font-size: 11px; }

        /* –ö–≤–µ—Å—Ç—ã */
        .quest-row {
            background: var(--card-bg); padding: 12px 15px; border-radius: 12px;
            margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center;
        }
        .quest-row.done { opacity: 0.4; filter: grayscale(1); }
        .check-box { width: 22px; height: 22px; border: 2px solid var(--accent); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .done .check-box { background: var(--accent); color: #000; }

        /* –§–æ—Ä–º—ã */
        input { width: 100%; background: #000; border: 1px solid #2c2c2e; color: #fff; padding: 12px; border-radius: 10px; margin-bottom: 8px; box-sizing: border-box; }
        .save-btn { background: linear-gradient(135deg, #ff9f0a 0%, #ff375f 100%); color: #fff; border: none; padding: 16px; border-radius: 12px; width: 100%; font-weight: 800; margin-top: 5px; cursor: pointer; }

        .hidden { display: none !important; }
        .profit { color: var(--success); }
        .loss { color: var(--danger); }
    </style>
</head>

<body>

<header>
    <div style="font-weight: 900; letter-spacing: -0.5px;">LEDGER <span style="color:var(--accent)">PRO</span></div>
    <div style="display: flex; gap: 8px;">
        <button onclick="tg.openLink('https://www.youtube.com/@BOOMBAHA')" class="header-btn" style="background: var(--youtube); color: white;">‚ñ∂ YouTube</button>
        <button onclick="tg.openLink('https://donatello.to/BOOMBAHA')" class="header-btn" style="background: var(--accent); color: #000;">üí∞ –î–æ–Ω–∞—Ç</button>
    </div>
</header>

<div class="container">
    <div id="home">
        <div class="stats-grid">
            <div class="stat-card">
                <small>–í—Å–µ —Ä–∞—Å—Ö–æ–¥—ã</small>
                <div id="sumBuy" class="loss">$ 0</div>
            </div>
            <div class="stat-card">
                <small>–í—Å–µ –¥–æ—Ö–æ–¥—ã</small>
                <div id="sumSell" class="profit">$ 0</div>
            </div>
        </div>

        <div class="journal-btn" onclick="nav('history')">üìÇ –û—Ç–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫</div>
        
        <div style="margin-bottom: 20px;">
            <small style="color:var(--text-secondary); margin-left: 5px;">–§–ò–õ–¨–¢–† –ü–û –î–ê–¢–ï</small>
            <input type="date" id="mainDate" onchange="refresh()">
        </div>

        <div class="menu-grid">
            <div class="cat-card" onclick="openCat('–ü—Ä–µ–¥–º–µ—Ç—ã')">üì¶<br><small>–ü—Ä–µ–¥–º–µ—Ç—ã</small></div>
            <div class="cat-card" onclick="openCat('–ú–∞—à–∏–Ω—ã')">üèéÔ∏è<br><small>–ú–∞—à–∏–Ω—ã</small></div>
            <div class="cat-card" onclick="openCat('–ê—Ä–µ–Ω–¥–∞')">üîë<br><small>–ê—Ä–µ–Ω–¥–∞</small></div>
            <div class="cat-card" onclick="openCat('–û–¥–µ–∂–¥–∞')">üëï<br><small>–û–¥–µ–∂–¥–∞</small></div>
        </div>

        <button onclick="nav('quests')" style="width:100%; margin-top:15px; padding:18px; border-radius:18px; background:var(--card-bg); color:var(--accent); border: 1px solid var(--accent); font-weight:bold; font-size: 14px;">
            üíé –ï–ñ–ï–î–ù–ï–í–ù–´–ï –ö–í–ï–°–¢–´ (60+)
        </button>

        <div style="background: var(--card-bg); border-radius: 20px; padding: 15px; margin-top: 20px;">
            <canvas id="mainChart" style="max-height: 250px;"></canvas>
        </div>
    </div>

    <div id="listPage" class="hidden">
        <button onclick="nav('home')" style="background:none; border:none; color:var(--accent); margin-bottom:15px; font-weight:bold; font-size:16px;">‚Üê –ù–ê–ó–ê–î</button>
        <h2 id="pageTitle" style="margin: 0 0 15px 0;">–°–¥–µ–ª–∫–∏</h2>
        
        <div id="addSection" class="hidden" style="background:var(--card-bg); padding:18px; border-radius:18px; margin-bottom:20px;">
            <input type="text" id="fName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (BMW, –ú–∞—Å–∫–∞ –∏ —Ç.–¥.)">
            <div style="display:flex; gap:10px;">
                <input type="number" id="fBuy" placeholder="–ü–æ—Ç—Ä–∞—Ç–∏–ª $">
                <input type="number" id="fSell" placeholder="–ü–æ–ª—É—á–∏–ª $">
            </div>
            <button class="save-btn" onclick="doAdd()">–°–û–•–†–ê–ù–ò–¢–¨ –í –ñ–£–†–ù–ê–õ</button>
        </div>

        <div id="itemsContainer"></div>
    </div>

    <div id="questPage" class="hidden">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
            <button onclick="nav('home')" style="background:none; border:none; color:var(--accent); font-weight:bold;">‚Üê –ù–ê–ó–ê–î</button>
            <button onclick="doReset()" style="background:var(--danger); border:none; color:white; padding:7px 15px; border-radius:10px; font-size:11px; font-weight:bold;">–°–ë–†–û–°–ò–¢–¨ –î–ï–ù–¨</button>
        </div>
        <div id="qContainer"></div>
    </div>
</div>

<script>
const tg = window.Telegram.WebApp;
const key = 'gta_boom_v6';
let app = JSON.parse(localStorage.getItem(key)) || {
    deals: [],
    quests: ["3 —á–∞—Å–∞ –æ–Ω–ª–∞–π–Ω", "–õ–æ—Ç–µ—Ä–µ—è", "–¢–∏—Ä", "–ö–∏–Ω–æ—Å—Ç—É–¥–∏—è", "–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä", "–°–∞–π—Ç", "Brawl", "–õ–∞–π–∫ –≤ Match", "–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å", "–ö–∏–Ω—É—Ç—å –º—è—á–∏–∫", "–î—Ä–µ—Å—Å–∏—Ä–æ–≤–∫–∞", "–°—Ç–∞–≤–∫–∞ –≤ –∫–æ–ª–µ—Å–µ", "–ú–µ—Ç—Ä–æ", "–†—ã–±–∞–ª–∫–∞", "–ó–∞–¥–∞–Ω–∏—è –∫–ª—É–±–∞", "–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å", "–ë–∞—Å–∫–µ—Ç–±–æ–ª", "–§—É—Ç–±–æ–ª", "–ê—Ä–º—Ä–µ—Å—Ç–ª–∏–Ω–≥", "–î–∞—Ä—Ç—Å", "–í–æ–ª–µ–π–±–æ–ª", "–ü–∏–Ω–≥-–ø–æ–Ω–≥", "–ë–æ–ª—å—à–æ–π —Ç–µ–Ω–Ω–∏—Å", "–°—ã–≥—Ä–∞—Ç—å –≤ –º–∞—Ñ–∏—é", "–ü–ª–∞—Ç–µ–∂ –ø–æ –ª–∏–∑–∏–Ω–≥—É", "–ì–æ–Ω–∫–∞", "–ê—Ä–µ–Ω–∞", "–°—Ç—Ä–æ–π–∫–∞", "–ü–æ—Ä—Ç", "–®–∞—Ö—Ç–∞", "–§–µ—Ä–º–∞", "–ö–∞—Ä—Ç–∏–Ω–≥", "–°–æ–∫—Ä–æ–≤–∏—â–µ", "–ê–≤—Ç–æ–±—É—Å", "–ü–æ—á—Ç–∞", "–ù—É–ª–∏ –≤ –∫–∞–∑–∏–Ω–æ", "–î–µ–Ω—Å –±–∞—Ç–ª", "–¢—Ä–µ–Ω–∞–∂–µ—Ä–Ω—ã–π –∑–∞–ª", "–¢—Ä–µ–Ω–µ—Ä. –∫–æ–º–ø–ª–µ–∫—Å", "–û—Ö–æ—Ç–∞", "–ü–æ–∂–∞—Ä–Ω—ã–π", "–î–∞–ª—å–Ω–æ–±–æ–π—â–∏–∫", "–ó–∞–∫–∞–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤", "–°–º–µ–Ω–∞ –≤–Ω–µ—à–Ω–æ—Å—Ç–∏", "–ì—Ä–∞—Ñ—Ñ–∏—Ç–∏", "–ö–æ–Ω—Ç—Ä–∞–±–∞–Ω–¥–∞", "–¢—Ä–∞–≤–∞ –≤ —Ç–µ–ø–ª–∏—Ü–µ", "–û–±–µ–∑–±–æ–ª –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏", "–ë–∏–∑–≤–∞—Ä", "–ö–∞–ø—Ç", "–•–∞–º–º–µ—Ä —Å –í–ó–•", "–ú–µ–¥–∫–∞—Ä—Ç—ã –≤ EMS", "–í—ã–∑–æ–≤—ã –≤ EMS", "–ó–µ–ª—ë–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ WN", "–û–±—ä—è–≤–ª–µ–Ω–∏—è WN", "–û–≥—Ä–∞–±–ª–µ–Ω–∏—è –¥–æ–º–æ–≤", "–ö–æ–¥—ã", "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–≤—Ç–æ", "–ê—Ä–µ—Å—Ç", "–í—ã–∫—É–ø —Å –ö–ü–ó", "–ê–∏—Ä–¥—Ä–æ–ø"].map(n => ({n, d: false}))
};

let chart = null;
let curCat = '';

function save() { localStorage.setItem(key, JSON.stringify(app)); refresh(); }
function fmt(n) { return '$ ' + Math.abs(n).toLocaleString(); }

function nav(id) {
    document.querySelectorAll('.container > div').forEach(d => d.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
}

function openCat(c) {
    curCat = c;
    nav('listPage');
    document.getElementById('pageTitle').innerText = c;
    document.getElementById('addSection').classList.remove('hidden');
    renderList('cat');
}

function openHistory() {
    curCat = '';
    nav('listPage');
    document.getElementById('pageTitle').innerText = '–ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫';
    document.getElementById('addSection').classList.add('hidden');
    renderList('all');
}

function doAdd() {
    const name = document.getElementById('fName').value;
    const b = Number(document.getElementById('fBuy').value) || 0;
    const s = Number(document.getElementById('fSell').value) || 0;
    if(!name) return;
    app.deals.push({id: Date.now(), c: curCat, n: name, b, s, d: new Date().toISOString().split('T')[0]});
    document.getElementById('fName').value = ''; 
    document.getElementById('fBuy').value = ''; 
    document.getElementById('fSell').value = '';
    save(); renderList('cat');
}

function renderList(mode) {
    const cont = document.getElementById('itemsContainer');
    cont.innerHTML = '';
    const list = mode === 'all' ? app.deals : app.deals.filter(x => x.c === curCat);
    list.sort((a,b) => b.id - a.id).forEach(x => {
        cont.innerHTML += `
            <div class="deal-item">
                <div class="info">
                    <small>${x.d} ‚Ä¢ ${x.c}</small>
                    <b>${x.n}</b>
                </div>
                <div style="text-align:right">
                    <div class="loss">-${fmt(x.b)}</div>
                    <div class="profit">+${fmt(x.s)}</div>
                    <small style="color:var(--danger); cursor:pointer" onclick="del(${x.id})">–£–¥–∞–ª–∏—Ç—å</small>
                </div>
            </div>`;
    });
}

function del(id) { 
    if(confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) { 
        app.deals = app.deals.filter(x => x.id !== id); 
        save(); 
        renderList(curCat ? 'cat' : 'all'); 
    } 
}

function renderQuests() {
    const cont = document.getElementById('qContainer');
    cont.innerHTML = '';
    app.quests.forEach((q, i) => {
        const div = document.createElement('div');
        div.className = 'quest-row ' + (q.d ? 'done' : '');
        div.onclick = () => { app.quests[i].d = !app.quests[i].d; save(); renderQuests(); };
        div.innerHTML = `<span>${q.n}</span><div class="check-box">${q.d ? '‚úì' : ''}</div>`;
        cont.appendChild(div);
    });
}

function doReset() { if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ –¥–µ–Ω—å?')) { app.quests.forEach(q => q.d = false); save(); renderQuests(); } }

function refresh() {
    const filter = document.getElementById('mainDate').value;
    const filtered = filter ? app.deals.filter(x => x.d === filter) : app.deals;
    
    // –ü–†–û–°–¢–ê–Ø –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê: –°—á–∏—Ç–∞–µ–º –≤—Å—ë
    const totalBuy = filtered.reduce((acc, x) => acc + x.b, 0);
    const totalSell = filtered.reduce((acc, x) => acc + x.s, 0);
    
    document.getElementById('sumBuy').textContent = fmt(totalBuy);
    document.getElementById('sumSell').textContent = fmt(totalSell);
    
    updateChart();
}

function updateChart() {
    const ctx = document.getElementById('mainChart').getContext('2d');
    const cats = ['–ü—Ä–µ–¥–º–µ—Ç—ã', '–ú–∞—à–∏–Ω—ã', '–ê—Ä–µ–Ω–¥–∞', '–û–¥–µ–∂–¥–∞'];
    const data = cats.map(c => app.deals.filter(x => x.c === c).reduce((acc, x) => acc + (x.s - x.b), 0));
    
    if(chart) chart.destroy();
    chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: cats,
            datasets: [{ label: '–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º', data: data, backgroundColor: ['#ff9f0a', '#30d158', '#ff453a', '#5856d6'], borderRadius: 8 }]
        },
        options: { 
            plugins: { legend: { display: false } },
            scales: { y: { grid: { color: '#222' }, ticks: { color: '#888' } }, x: { ticks: { color: '#888' } } }
        }
    });
}

// –ó–∞–ø—É—Å–∫
document.getElementById('mainDate').value = new Date().toISOString().split('T')[0];
refresh();
if(!document.getElementById('questPage').classList.contains('hidden')) renderQuests();
</script>

</body>
</html>
