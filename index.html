<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>GTA RP –ü–µ—Ä–µ–∫—É–ø</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { margin:0; font-family:Arial; background:#0e0e0e; color:#fff; }
header { padding:15px; text-align:center; font-size:20px; font-weight:bold; border-bottom:2px solid orange; position:relative; }
.container { padding:15px; }
button { width:100%; padding:12px; margin-top:8px; border-radius:8px; font-size:16px; font-weight:bold; cursor:pointer; background:orange; color:#000; border:none; }
button:active { opacity:0.8; }
.box { background:#1a1a1a; border-radius:10px; padding:15px; margin-bottom:15px; display:none; }
input, select { width:100%; padding:10px; margin-top:8px; background:#000; color:#fff; border:1px solid #333; border-radius:6px; font-size:16px; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { border:1px solid #333; padding:6px; text-align:center; }
th { background:#222; }
.profit { color:#0f0; font-weight:bold; font-size:18px; }
.loss { color:red; font-weight:bold; font-size:18px; }
@media(max-width:600px){ input, button { font-size:14px; padding:8px; } th, td { font-size:12px; padding:4px; } }
.donate-btn { position:absolute; top:15px; right:15px; background:#ff0; color:#000; padding:8px 12px; border-radius:6px; font-weight:bold; cursor:pointer; }
.edit-btn { background:#00f; color:#fff; padding:4px 8px; font-size:12px; }
.save-btn { background:#0f0; color:#000; padding:4px 8px; font-size:12px; }
</style>
</head>

<body>
<header>
  GTA RP ‚Ä¢ –ü–µ—Ä–µ–∫—É–ø
  <button class="donate-btn" onclick="donate()">üí∞ –î–æ–Ω–∞—Ç</button>
</header>

<div class="container">

<!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
<div id="mainScreen" class="box" style="display:block;">
  <h3>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h3>

  <label>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</label>
  <input type="date" id="mainFilterDate" onchange="updateTotals()">

  <button onclick="showCategory('–ü—Ä–µ–¥–º–µ—Ç—ã')">–ü—Ä–µ–¥–º–µ—Ç—ã</button>
  <button onclick="showCategory('–ê—Ä–µ–Ω–¥–∞')">–ê—Ä–µ–Ω–¥–∞</button>
  <button onclick="showCategory('–ú–∞—à–∏–Ω—ã')">–ú–∞—à–∏–Ω—ã</button>
  <button onclick="showCategory('–®–º–æ—Ç–∫–∏')">–®–º–æ—Ç–∫–∏</button>

  <!-- –û—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫ –ë–æ–Ω—É—Å–ö–æ–∏–Ω—Ç—ã -->
  <div style="background:#333; padding:15px; border-radius:10px; margin-top:10px;">
    <h3>–ë–æ–Ω—É—Å–ö–æ–∏–Ω—Ç—ã</h3>
    <button onclick="showBonus()">–û—Ç–∫—Ä—ã—Ç—å –±–æ–Ω—É—Å—ã</button>
  </div>

  <p>–û–±—â–∏–π —Ä–∞—Å—Ö–æ–¥: <span id="totalBuy" class="loss">$0</span></p>
  <p>–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å: <span id="totalSell" class="profit">$0</span></p>
</div>

<!-- –†–∞–∑–¥–µ–ª –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
<div id="categoryBox" class="box">
  <h3 id="categoryTitle"></h3>
  <label>–§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ</label>
  <input type="date" id="categoryFilterDate" onchange="renderCategoryTable()">

  <input type="text" id="itemName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
  <input type="number" id="buy" placeholder="–ü–æ–∫—É–ø–∫–∞">
  <input type="number" id="sell" placeholder="–ü—Ä–æ–¥–∞–∂–∞">
  <button onclick="addDeal()">–î–æ–±–∞–≤–∏—Ç—å —Å–¥–µ–ª–∫—É</button>

  <p>–†–∞—Å—Ö–æ–¥: <span id="categoryBuy" class="loss">$0</span></p>
  <p>–ü—Ä–∏–±—ã–ª—å: <span id="categorySell" class="profit">$0</span></p>

  <table>
    <thead>
      <tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–ü–æ–∫—É–ø–∫–∞</th><th>–ü—Ä–æ–¥–∞–∂–∞</th><th>–ü—Ä–∏–±—ã–ª—å</th><th>–î–∞—Ç–∞</th><th>–£–¥–∞–ª–∏—Ç—å</th></tr>
    </thead>
    <tbody id="categoryTableBody"></tbody>
  </table>
  <button onclick="backToMain()">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<!-- –†–∞–∑–¥–µ–ª –±–æ–Ω—É—Å–∫–æ–∏–Ω—Ç–æ–≤ -->
<div id="bonusBox" class="box">
  <h3>–ë–æ–Ω—É—Å–ö–æ–∏–Ω—Ç—ã</h3>
  <table>
    <thead>
      <tr><th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th><th>–ò—Ç–æ–≥</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th></tr>
    </thead>
    <tbody id="bonusTableBody"></tbody>
  </table>
  <button onclick="backToMain()">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

</div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();

// –î–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const userId = tg.initDataUnsafe.user.id;
let deals = JSON.parse(localStorage.getItem('deals_'+userId)) || [];
let bonusCoins = JSON.parse(localStorage.getItem('bonus_'+userId)) || [
  {name:'–ë–æ–Ω—É—Å 1', desc:'–û–ø–∏—Å–∞–Ω–∏–µ 1', total:100},
  {name:'–ë–æ–Ω—É—Å 2', desc:'–û–ø–∏—Å–∞–Ω–∏–µ 2', total:200}
];
let currentCategory = '';

// –ì–ª–∞–≤–Ω–∞—è –¥–∞—Ç–∞ —Ñ–∏–ª—å—Ç—Ä
const mainFilter = document.getElementById('mainFilterDate');

// –ü–æ–∫–∞–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
function showCategory(category){
  currentCategory = category;
  document.getElementById('mainScreen').style.display='none';
  document.getElementById('bonusBox').style.display='none';
  document.getElementById('categoryBox').style.display='block';
  document.getElementById('categoryTitle').textContent=category;
  document.getElementById('categoryFilterDate').value='';
  renderCategoryTable();
}

// –ü–æ–∫–∞–∑ –±–æ–Ω—É—Å–æ–≤
function showBonus(){
  document.getElementById('mainScreen').style.display='none';
  document.getElementById('categoryBox').style.display='none';
  document.getElementById('bonusBox').style.display='block';
  renderBonusTable();
}

// –ù–∞–∑–∞–¥
function backToMain(){
  document.getElementById('mainScreen').style.display='block';
  document.getElementById('categoryBox').style.display='none';
  document.getElementById('bonusBox').style.display='none';
  updateTotals();
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏
function addDeal(){
  const name = document.getElementById('itemName').value;
  const buy = Number(document.getElementById('buy').value)||0;
  const sell = Number(document.getElementById('sell').value)||0;
  const date = document.getElementById('categoryFilterDate').value || new Date().toISOString().split('T')[0];
  if(!name){ alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ'); return; }

  deals.push({category:currentCategory, name, buy, sell, date});
  localStorage.setItem('deals_'+userId, JSON.stringify(deals));

  document.getElementById('itemName').value='';
  document.getElementById('buy').value='';
  document.getElementById('sell').value='';
  renderCategoryTable();
  updateTotals();
}

// –£–¥–∞–ª–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏
function deleteDeal(index){
  deals.splice(index,1);
  localStorage.setItem('deals_'+userId, JSON.stringify(deals));
  renderCategoryTable();
  updateTotals();
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
function renderCategoryTable(){
  const tbody = document.getElementById('categoryTableBody');
  tbody.innerHTML='';
  const filterDate = document.getElementById('categoryFilterDate').value;
  let totalBuy=0, totalSell=0;

  // —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ
  deals.sort((a,b)=>new Date(b.date)-new Date(a.date));

  deals.forEach((d,i)=>{
    if(d.category===currentCategory && (!filterDate || d.date===filterDate)){
      totalBuy += d.buy;
      totalSell += d.sell;
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${d.name}</td><td>${d.buy}</td><td>${d.sell}</td><td>${d.sell-d.buy}</td><td>${d.date}</td>
      <td><button onclick="deleteDeal(${i})">‚ùå</button></td>`;
      tbody.appendChild(tr);
    }
  });
  document.getElementById('categoryBuy').textContent='$'+totalBuy;
  document.getElementById('categorySell').textContent='$'+totalSell;
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –±–æ–Ω—É—Å–æ–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
function renderBonusTable(){
  const tbody = document.getElementById('bonusTableBody');
  tbody.innerHTML='';
  bonusCoins.forEach((b,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="text" value="${b.name}" onchange="bonusCoins[${i}].name=this.value; saveBonus()"></td>
      <td><input type="text" value="${b.desc}" onchange="bonusCoins[${i}].desc=this.value; saveBonus()"></td>
      <td><input type="number" value="${b.total}" onchange="bonusCoins[${i}].total=Number(this.value); saveBonus()"></td>
      <td><button onclick="deleteBonus(${i})">‚ùå</button></td>`;
    tbody.appendChild(tr);
  });
}

function saveBonus(){
  localStorage.setItem('bonus_'+userId, JSON.stringify(bonusCoins));
}

function deleteBonus(index){
  bonusCoins.splice(index,1);
  saveBonus();
  renderBonusTable();
}

// –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –¥–∞—Ç—ã
function updateTotals(){
  const date = mainFilter.value;
  const filtered = date ? deals.filter(d=>d.date===date) : deals;
  const totalBuy = filtered.reduce((a,d)=>a+d.buy,0);
  const totalSell = filtered.reduce((a,d)=>a+d.sell,0);
  document.getElementById('totalBuy').textContent='$'+totalBuy;
  document.getElementById('totalSell').textContent='$'+totalSell;
}

// –î–æ–Ω–∞—Ç
function donate(){
  window.open('https://your-donation-link.com','_blank');
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
updateTotals();
</script>

</body>
</html>
