<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>GTA RP | –ü–µ—Ä–µ–∫—É–ø</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
    <style>
        :root {
            --bg: #0f0f13;
            --card-bg: #1c1c24;
            --accent: #ff9f0a;
            --success: #32d74b;
            --danger: #ff453a;
            --text-main: #ffffff;
            --text-secondary: #8e8e93;
            --grad: linear-gradient(135deg, #ff9f0a 0%, #ff375f 100%);
        }

        body { 
            margin:0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg); 
            color: var(--text-main);
            -webkit-font-smoothing: antialiased;
        }

        /* –®–∞–ø–∫–∞ */
        header { 
            padding: 20px 15px;
            text-align: left;
            background: rgba(28, 28, 36, 0.8);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 { margin: 0; font-size: 18px; font-weight: 800; letter-spacing: 1px; color: var(--accent); }

        .container { padding: 15px; padding-bottom: 100px; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 12px; 
            margin-bottom: 20px; 
        }

        .stat-card {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .stat-card small { color: var(--text-secondary); font-size: 12px; display: block; margin-bottom: 5px; }
        .stat-card div { font-size: 18px; font-weight: bold; }

        /* –ö–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .btn-cat {
            background: var(--card-bg);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
            color: white;
            text-align: center;
            transition: 0.2s;
            cursor: pointer;
        }

        .btn-cat:active { transform: scale(0.95); background: rgba(255,255,255,0.05); }
        .btn-cat i { font-size: 24px; display: block; margin-bottom: 8px; }

        /* –§–æ—Ä–º—ã –≤–≤–æ–¥–∞ */
        .input-group {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 16px;
            margin-bottom: 20px;
        }

        input, select {
            width: 100%;
            background: #000;
            border: 1px solid #333;
            color: white;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
            font-size: 14px;
        }

        button.primary {
            background: var(--grad);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 12px;
            width: 100%;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(255, 55, 95, 0.3);
        }

        /* –°–ø–∏—Å–æ–∫ —Å–¥–µ–ª–æ–∫ */
        .deal-item {
            background: var(--card-bg);
            margin-bottom: 10px;
            padding: 12px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--accent);
        }

        .deal-info h4 { margin: 0; font-size: 15px; }
        .deal-info small { color: var(--text-secondary); }

        .deal-price { text-align: right; }
        .profit { color: var(--success); font-weight: bold; }
        .loss { color: var(--danger); font-weight: bold; }

        .btn-back { background: none; border: none; color: var(--accent); font-weight: bold; cursor: pointer; padding: 10px 0; }

        /* –î–æ–Ω–∞—Ç */
        .donate-pill {
            background: #ffd700;
            color: #000;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-decoration: none;
        }

        .hidden { display: none; }
    </style>
</head>

<body>

<header>
    <h1>GTA LEDGER</h1>
    <a href="#" class="donate-pill" onclick="donate()">üí∞ DONATE</a>
</header>

<div class="container">

    <div id="mainScreen">
        <div class="stats-grid">
            <div class="stat-card">
                <small>–ó–∞—Ç—Ä–∞—Ç—ã</small>
                <div id="totalBuy" style="color: var(--danger);">$0</div>
            </div>
            <div class="stat-card">
                <small>–ü—Ä–∏–±—ã–ª—å</small>
                <div id="totalSell" style="color: var(--success);">$0</div>
            </div>
        </div>

        <label style="color: var(--text-secondary); font-size: 12px; margin-left: 5px;">–û–¢–ß–ï–¢ –ó–ê –ü–ï–†–ò–û–î:</label>
        <input type="date" id="mainFilterDate" onchange="updateTotals()">

        <div class="menu-grid">
            <div class="btn-cat" onclick="showCategory('–ü—Ä–µ–¥–º–µ—Ç—ã')">üì¶<br>–ü—Ä–µ–¥–º–µ—Ç—ã</div>
            <div class="btn-cat" onclick="showCategory('–ú–∞—à–∏–Ω—ã')">üèéÔ∏è<br>–ú–∞—à–∏–Ω—ã</div>
            <div class="btn-cat" onclick="showCategory('–ê—Ä–µ–Ω–¥–∞')">üîë<br>–ê—Ä–µ–Ω–¥–∞</div>
            <div class="btn-cat" onclick="showCategory('–û–¥–µ–∂–¥–∞')">üëï<br>–û–¥–µ–∂–¥–∞</div>
        </div>

        <div class="btn-cat" onclick="showBonus()" style="margin-top:12px; width:100%; box-sizing:border-box; border-color: rgba(255,159,10,0.3);">
            üíé –ë–æ–Ω—É—Å–ö–æ–∏–Ω—Ç—ã
        </div>
    </div>

    <div id="categoryBox" class="hidden">
        <button class="btn-back" onclick="backToMain()">‚Üê –ù–ê–ó–ê–î –ö –ú–ï–ù–Æ</button>
        <h2 id="categoryTitle" style="margin-top: 10px; color: var(--accent);">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</h2>

        <div class="input-group">
            <input type="text" id="itemName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: BMW M5)">
            <div style="display:flex; gap:10px;">
                <input type="number" id="buy" placeholder="–ö—É–ø–∏–ª –∑–∞">
                <input type="number" id="sell" placeholder="–ü—Ä–æ–¥–∞–ª –∑–∞">
            </div>
            <button class="primary" onclick="addDeal()">–°–û–•–†–ê–ù–ò–¢–¨ –°–î–ï–õ–ö–£</button>
        </div>

        <div id="dealsList">
            </div>
    </div>

    <div id="bonusBox" class="hidden">
        <button class="btn-back" onclick="backToMain()">‚Üê –ù–ê–ó–ê–î –ö –ú–ï–ù–Æ</button>
        <h2 style="color: var(--accent);">–ë–æ–Ω—É—Å–Ω—ã–µ –±–∞–ª–ª—ã</h2>
        <div id="bonusList"></div>
        <button class="primary" onclick="addBonusRow()" style="margin-top: 15px;">+ –î–û–ë–ê–í–ò–¢–¨ –°–¢–†–û–ö–£</button>
    </div>

</div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();
tg.headerColor = '#1c1c24';

const userId = tg.initDataUnsafe.user?.id || "local_dev";
let deals = JSON.parse(localStorage.getItem('deals_'+userId)) || [];
let bonusCoins = JSON.parse(localStorage.getItem('bonus_'+userId)) || [{name:'BC –±–∞–ª–ª—ã', total:0}];
let currentCategory = '';

function formatMoney(num) {
    return '$ ' + num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
}

function showCategory(cat) {
    currentCategory = cat;
    document.getElementById('mainScreen').classList.add('hidden');
    document.getElementById('categoryBox').classList.remove('hidden');
    document.getElementById('categoryTitle').textContent = cat;
    renderDeals();
}

function showBonus() {
    document.getElementById('mainScreen').classList.add('hidden');
    document.getElementById('bonusBox').classList.remove('hidden');
    renderBonus();
}

function backToMain() {
    document.getElementById('categoryBox').classList.add('hidden');
    document.getElementById('bonusBox').classList.add('hidden');
    document.getElementById('mainScreen').classList.remove('hidden');
    updateTotals();
}

function addDeal() {
    const name = document.getElementById('itemName').value;
    const buy = Number(document.getElementById('buy').value) || 0;
    const sell = Number(document.getElementById('sell').value) || 0;
    const date = new Date().toISOString().split('T')[0];

    if(!name) { tg.showAlert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ!'); return; }

    deals.push({id: Date.now(), category: currentCategory, name, buy, sell, date});
    save();
    
    document.getElementById('itemName').value = '';
    document.getElementById('buy').value = '';
    document.getElementById('sell').value = '';
    renderDeals();
}

function renderDeals() {
    const list = document.getElementById('dealsList');
    list.innerHTML = '';
    
    const filtered = deals
        .filter(d => d.category === currentCategory)
        .sort((a,b) => b.id - a.id);

    filtered.forEach(d => {
        const profit = d.sell - d.buy;
        const div = document.createElement('div');
        div.className = 'deal-item';
        div.innerHTML = `
            <div class="deal-info">
                <h4>${d.name}</h4>
                <small>${d.date} ‚Ä¢ –ö—É–ø–ª–µ–Ω–æ: ${formatMoney(d.buy)}</small>
            </div>
            <div class="deal-price">
                <div class="${profit >= 0 ? 'profit' : 'loss'}">${profit >= 0 ? '+' : ''}${formatMoney(profit)}</div>
                <small onclick="deleteDeal(${d.id})" style="color:var(--danger); cursor:pointer;">–£–¥–∞–ª–∏—Ç—å</small>
            </div>
        `;
        list.appendChild(div);
    });
}

function renderBonus() {
    const list = document.getElementById('bonusList');
    list.innerHTML = '';
    bonusCoins.forEach((b, i) => {
        const div = document.createElement('div');
        div.className = 'input-group';
        div.style.marginBottom = '10px';
        div.innerHTML = `
            <input type="text" value="${b.name}" onchange="updateBonus(${i}, 'name', this.value)" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
            <input type="number" value="${b.total}" onchange="updateBonus(${i}, 'total', this.value)" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">
            <button onclick="deleteBonus(${i})" style="background:none; color:var(--danger); border:none; width:100%; font-size:12px;">–£–¥–∞–ª–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä</button>
        `;
        list.appendChild(div);
    });
}

function updateBonus(idx, field, val) {
    bonusCoins[idx][field] = field === 'total' ? Number(val) : val;
    save();
}

function addBonusRow() {
    bonusCoins.push({name: '', total: 0});
    renderBonus();
}

function deleteDeal(id) {
    deals = deals.filter(d => d.id !== id);
    save();
    renderDeals();
}

function deleteBonus(idx) {
    bonusCoins.splice(idx, 1);
    save();
    renderBonus();
}

function updateTotals() {
    const filterDate = document.getElementById('mainFilterDate').value;
    const filtered = filterDate ? deals.filter(d => d.date === filterDate) : deals;
    
    const buy = filtered.reduce((a, b) => a + b.buy, 0);
    const sell = filtered.reduce((a, b) => a + (b.sell - b.buy), 0);
    
    document.getElementById('totalBuy').textContent = formatMoney(buy);
    document.getElementById('totalSell').textContent = (sell >= 0 ? '+' : '') + formatMoney(sell);
}

function save() {
    localStorage.setItem('deals_'+userId, JSON.stringify(deals));
    localStorage.setItem('bonus_'+userId, JSON.stringify(bonusCoins));
}

function donate() {
    tg.openLink('https://donationalerts.com'); // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à—É —Å—Å—ã–ª–∫—É
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
updateTotals();
</script>

</body>
</html>
