<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>GTA RP | BOOMBAHA Ledger v7</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
    <style>
        :root {
            --bg: #0b0b0e;
            --card-bg: #16161d;
            --accent: #ff9f0a;
            --success: #30d158;
            --danger: #ff453a;
            --youtube: #ff0000;
            --text-main: #ffffff;
            --text-secondary: #8e8e93;
        }

        body { 
            margin:0; font-family: -apple-system, system-ui, sans-serif;
            background: var(--bg); color: var(--text-main); 
            user-select: none; -webkit-tap-highlight-color: transparent;
        }

        header { 
            padding: 15px; background: var(--card-bg); 
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .header-btn {
            border: none; padding: 7px 12px; border-radius: 8px;
            font-weight: bold; font-size: 11px; cursor: pointer;
            display: inline-flex; align-items: center;
        }

        .container { padding: 15px; padding-bottom: 50px; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-card { background: var(--card-bg); padding: 15px; border-radius: 14px; }
        .stat-card small { font-size: 10px; color: var(--text-secondary); text-transform: uppercase; }
        .stat-card div { font-size: 18px; font-weight: 800; margin-top: 5px; }

        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .cat-card { background: var(--card-bg); border-radius: 16px; padding: 20px; text-align: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.02); }
        
        .journal-btn { background: #24242f; color: #fff; padding: 15px; border-radius: 14px; text-align: center; margin: 15px 0; font-weight: 600; cursor: pointer; }

        .deal-item { 
            background: var(--card-bg); padding: 14px; border-radius: 12px; 
            margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;
            border-left: 4px solid var(--accent);
        }

        .quest-row {
            background: var(--card-bg); padding: 12px 15px; border-radius: 12px;
            margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center;
        }
        .quest-row.done { opacity: 0.4; filter: grayscale(1); }
        .check-box { width: 22px; height: 22px; border: 2px solid var(--accent); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .done .check-box { background: var(--accent); color: #000; }

        input { width: 100%; background: #000; border: 1px solid #2c2c2e; color: #fff; padding: 12px; border-radius: 10px; margin-bottom: 8px; box-sizing: border-box; }
        .save-btn { background: linear-gradient(135deg, #ff9f0a 0%, #ff375f 100%); color: #fff; border: none; padding: 16px; border-radius: 12px; width: 100%; font-weight: 800; cursor: pointer; }

        .hidden { display: none !important; }
        .profit { color: var(--success); }
        .loss { color: var(--danger); }
    </style>
</head>

<body>

<header id="appHeader">
    <div style="font-weight: 900;">LEDGER <span style="color:var(--accent)">PRO</span></div>
    <div style="display: flex; gap: 8px;">
        <button onclick="tg.openLink('https://www.youtube.com/@BOOMBAHA')" class="header-btn" style="background: var(--youtube); color: white;">‚ñ∂ YouTube</button>
        <button onclick="tg.openLink('https://donatello.to/BOOMBAHA')" class="header-btn" style="background: var(--accent); color: #000;">üí∞ –î–æ–Ω–∞—Ç</button>
    </div>
</header>

<div class="container">
    <div id="screenHome">
        <div class="stats-grid">
            <div class="stat-card"><small>–í—Å–µ —Ä–∞—Å—Ö–æ–¥—ã</small><div id="sumBuy" class="loss">$ 0</div></div>
            <div class="stat-card"><small>–í—Å–µ –¥–æ—Ö–æ–¥—ã</small><div id="sumSell" class="profit">$ 0</div></div>
        </div>

        <div class="journal-btn" onclick="openHistory()">üìÇ –û—Ç–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫</div>
        
        <input type="date" id="mainDate" onchange="refreshData()">

        <div class="menu-grid">
            <div class="cat-card" onclick="openCat('–ü—Ä–µ–¥–º–µ—Ç—ã')">üì¶<br><small>–ü—Ä–µ–¥–º–µ—Ç—ã</small></div>
            <div class="cat-card" onclick="openCat('–ú–∞—à–∏–Ω—ã')">üèéÔ∏è<br><small>–ú–∞—à–∏–Ω—ã</small></div>
            <div class="cat-card" onclick="openCat('–ê—Ä–µ–Ω–¥–∞')">üîë<br><small>–ê—Ä–µ–Ω–¥–∞</small></div>
            <div class="cat-card" onclick="openCat('–û–¥–µ–∂–¥–∞')">üëï<br><small>–û–¥–µ–∂–¥–∞</small></div>
        </div>

        <button onclick="openQuests()" style="width:100%; margin-top:15px; padding:18px; border-radius:18px; background:var(--card-bg); color:var(--accent); border: 1px solid var(--accent); font-weight:bold;">üíé –ï–ñ–ï–î–ù–ï–í–ù–´–ï –ö–í–ï–°–¢–´</button>

        <div style="background: var(--card-bg); border-radius: 20px; padding: 15px; margin-top: 20px;">
            <canvas id="mainChart"></canvas>
        </div>
    </div>

    <div id="screenList" class="hidden">
        <button onclick="showScreen('screenHome')" style="background:none; border:none; color:var(--accent); margin-bottom:15px; font-weight:bold; font-size:16px;">‚Üê –ù–ê–ó–ê–î</button>
        <h2 id="pageTitle" style="margin: 0 0 15px 0;">–°–¥–µ–ª–∫–∏</h2>
        
        <div id="addFormBox" class="hidden" style="background:var(--card-bg); padding:18px; border-radius:18px; margin-bottom:20px;">
            <input type="text" id="fName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
            <div style="display:flex; gap:10px;">
                <input type="number" id="fBuy" placeholder="–†–∞—Å—Ö–æ–¥ $">
                <input type="number" id="fSell" placeholder="–î–æ—Ö–æ–¥ $">
            </div>
            <button class="save-btn" onclick="addDeal()">–°–û–•–†–ê–ù–ò–¢–¨</button>
        </div>

        <div id="itemsContainer"></div>
    </div>

    <div id="screenQuests" class="hidden">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
            <button onclick="showScreen('screenHome')" style="background:none; border:none; color:var(--accent); font-weight:bold;">‚Üê –ù–ê–ó–ê–î</button>
            <button onclick="resetQuests()" style="background:var(--danger); border:none; color:white; padding:7px 15px; border-radius:10px; font-size:11px;">–°–ë–†–û–°–ò–¢–¨ –î–ï–ù–¨</button>
        </div>
        <div id="questContainer"></div>
    </div>
</div>

<script>
const tg = window.Telegram.WebApp;
const DB_KEY = 'gta_boom_v7_final';
let state = JSON.parse(localStorage.getItem(DB_KEY)) || {
    deals: [],
    quests: ["3 —á–∞—Å–∞ –æ–Ω–ª–∞–π–Ω", "–õ–æ—Ç–µ—Ä–µ—è", "–¢–∏—Ä", "–ö–∏–Ω–æ—Å—Ç—É–¥–∏—è", "–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä", "–°–∞–π—Ç", "Brawl", "–õ–∞–π–∫ –≤ Match", "–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å", "–ö–∏–Ω—É—Ç—å –º—è—á–∏–∫", "–î—Ä–µ—Å—Å–∏—Ä–æ–≤–∫–∞", "–°—Ç–∞–≤–∫–∞ –≤ –∫–æ–ª–µ—Å–µ", "–ú–µ—Ç—Ä–æ", "–†—ã–±–∞–ª–∫–∞", "–ó–∞–¥–∞–Ω–∏—è –∫–ª—É–±–∞", "–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å", "–ë–∞—Å–∫–µ—Ç–±–æ–ª", "–§—É—Ç–±–æ–ª", "–ê—Ä–º—Ä–µ—Å—Ç–ª–∏–Ω–≥", "–î–∞—Ä—Ç—Å", "–í–æ–ª–µ–π–±–æ–ª", "–ü–∏–Ω–≥-–ø–æ–Ω–≥", "–ë–æ–ª—å—à–æ–π —Ç–µ–Ω–Ω–∏—Å", "–°—ã–≥—Ä–∞—Ç—å –≤ –º–∞—Ñ–∏—é", "–ü–ª–∞—Ç–µ–∂ –ø–æ –ª–∏–∑–∏–Ω–≥—É", "–ì–æ–Ω–∫–∞", "–ê—Ä–µ–Ω–∞", "–°—Ç—Ä–æ–π–∫–∞", "–ü–æ—Ä—Ç", "–®–∞—Ö—Ç–∞", "–§–µ—Ä–º–∞", "–ö–∞—Ä—Ç–∏–Ω–≥", "–°–æ–∫—Ä–æ–≤–∏—â–µ", "–ê–≤—Ç–æ–±—É—Å", "–ü–æ—á—Ç–∞", "–ù—É–ª–∏ –≤ –∫–∞–∑–∏–Ω–æ", "–î–µ–Ω—Å –±–∞—Ç–ª", "–¢—Ä–µ–Ω–∞–∂–µ—Ä–Ω—ã–π –∑–∞–ª", "–¢—Ä–µ–Ω–µ—Ä. –∫–æ–º–ø–ª–µ–∫—Å", "–û—Ö–æ—Ç–∞", "–ü–æ–∂–∞—Ä–Ω—ã–π", "–î–∞–ª—å–Ω–æ–±–æ–π—â–∏–∫", "–ó–∞–∫–∞–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤", "–°–º–µ–Ω–∞ –≤–Ω–µ—à–Ω–æ—Å—Ç–∏", "–ì—Ä–∞—Ñ—Ñ–∏—Ç–∏", "–ö–æ–Ω—Ç—Ä–∞–±–∞–Ω–¥–∞", "–¢—Ä–∞–≤–∞ –≤ —Ç–µ–ø–ª–∏—Ü–µ", "–û–±–µ–∑–±–æ–ª –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏", "–ë–∏–∑–≤–∞—Ä", "–ö–∞–ø—Ç", "–•–∞–º–º–µ—Ä —Å –í–ó–•", "–ú–µ–¥–∫–∞—Ä—Ç—ã –≤ EMS", "–í—ã–∑–æ–≤—ã –≤ EMS", "–ó–µ–ª—ë–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ WN", "–û–±—ä—è–≤–ª–µ–Ω–∏—è WN", "–û–≥—Ä–∞–±–ª–µ–Ω–∏—è –¥–æ–º–æ–≤", "–ö–æ–¥—ã", "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–≤—Ç–æ", "–ê—Ä–µ—Å—Ç", "–í—ã–∫—É–ø —Å –ö–ü–ó", "–ê–∏—Ä–¥—Ä–æ–ø"].map(n => ({n, d: false}))
};

let myChart = null;
let currentCategory = '';

function saveAll() { localStorage.setItem(DB_KEY, JSON.stringify(state)); refreshData(); }
function fmt(n) { return '$ ' + Math.abs(n).toLocaleString(); }

function showScreen(id) {
    document.getElementById('screenHome').classList.add('hidden');
    document.getElementById('screenList').classList.add('hidden');
    document.getElementById('screenQuests').classList.add('hidden');
    document.getElementById(id).classList.remove('hidden');
    window.scrollTo(0,0);
}

function openCat(cat) {
    currentCategory = cat;
    document.getElementById('pageTitle').innerText = cat;
    document.getElementById('addFormBox').classList.remove('hidden');
    showScreen('screenList');
    renderItems('cat');
}

function openHistory() {
    currentCategory = '';
    document.getElementById('pageTitle').innerText = '–í—Å–µ —Å–¥–µ–ª–∫–∏';
    document.getElementById('addFormBox').classList.add('hidden');
    showScreen('screenList');
    renderItems('all');
}

function openQuests() {
    showScreen('screenQuests');
    renderQuests();
}

function addDeal() {
    const n = document.getElementById('fName').value;
    const b = Number(document.getElementById('fBuy').value) || 0;
    const s = Number(document.getElementById('fSell').value) || 0;
    if(!n) return;
    state.deals.push({id: Date.now(), c: currentCategory, n, b, s, d: new Date().toISOString().split('T')[0]});
    document.getElementById('fName').value = ''; 
    document.getElementById('fBuy').value = ''; 
    document.getElementById('fSell').value = '';
    saveAll(); renderItems('cat');
}

function renderItems(mode) {
    const cont = document.getElementById('itemsContainer');
    cont.innerHTML = '';
    const list = mode === 'all' ? state.deals : state.deals.filter(x => x.c === currentCategory);
    list.sort((a,b) => b.id - a.id).forEach(x => {
        cont.innerHTML += `
            <div class="deal-item">
                <div><small>${x.d} ‚Ä¢ ${x.c}</small><br><b>${x.n}</b></div>
                <div style="text-align:right">
                    <div class="loss">-${fmt(x.b)}</div>
                    <div class="profit">+${fmt(x.s)}</div>
                    <small style="color:var(--danger)" onclick="deleteItem(${x.id}, '${mode}')">–£–¥–∞–ª–∏—Ç—å</small>
                </div>
            </div>`;
    });
}

function deleteItem(id, mode) {
    state.deals = state.deals.filter(x => x.id !== id);
    saveAll(); renderItems(mode);
}

function renderQuests() {
    const cont = document.getElementById('questContainer');
    cont.innerHTML = '';
    state.quests.forEach((q, i) => {
        const div = document.createElement('div');
        div.className = 'quest-row ' + (q.d ? 'done' : '');
        div.onclick = () => { state.quests[i].d = !state.quests[i].d; saveAll(); renderQuests(); };
        div.innerHTML = `<span>${q.n}</span><div class="check-box">${q.d ? '‚úì' : ''}</div>`;
        cont.appendChild(div);
    });
}

function resetQuests() { if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –¥–µ–Ω—å?')) { state.quests.forEach(q => q.d = false); saveAll(); renderQuests(); } }

function refreshData() {
    const filter = document.getElementById('mainDate').value;
    const filtered = filter ? state.deals.filter(x => x.d === filter) : state.deals;
    const totalB = filtered.reduce((a, b) => a + b.b, 0);
    const totalS = filtered.reduce((a, b) => a + b.s, 0);
    document.getElementById('sumBuy').textContent = fmt(totalB);
    document.getElementById('sumSell').textContent = fmt(totalS);
    updateChart();
}

function updateChart() {
    const ctx = document.getElementById('mainChart').getContext('2d');
    const cats = ['–ü—Ä–µ–¥–º–µ—Ç—ã', '–ú–∞—à–∏–Ω—ã', '–ê—Ä–µ–Ω–¥–∞', '–û–¥–µ–∂–¥–∞'];
    const data = cats.map(c => state.deals.filter(x => x.c === c).reduce((a, b) => a + (b.s - b.b), 0));
    if(myChart) myChart.destroy();
    myChart = new Chart(ctx, {
        type: 'bar',
        data: { labels: cats, datasets: [{ data: data, backgroundColor: ['#ff9f0a', '#30d158', '#ff453a', '#5856d6'], borderRadius: 6 }] },
        options: { plugins: { legend: { display: false } }, scales: { y: { grid: { color: '#222' }, ticks: { color: '#888' } }, x: { ticks: { color: '#888' } } } }
    });
}

document.getElementById('mainDate').value = new Date().toISOString().split('T')[0];
refreshData();
tg.expand();
</script>

</body>
</html>
