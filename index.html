<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>GTA RP Перекуп</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { margin:0; font-family:Arial; background:#0e0e0e; color:#fff; }
header { padding:15px; text-align:center; font-size:20px; font-weight:bold; border-bottom:2px solid orange; }
.container { padding:15px; }
button { width:100%; padding:12px; margin-top:8px; border-radius:8px; font-size:16px; font-weight:bold; cursor:pointer; background:orange; color:#000; border:none; }
button:active { opacity:0.8; }
.box { background:#1a1a1a; border-radius:10px; padding:15px; margin-bottom:15px; display:none; }
input { width:100%; padding:10px; margin-top:8px; background:#000; color:#fff; border:1px solid #333; border-radius:6px; font-size:16px; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { border:1px solid #333; padding:6px; text-align:center; }
th { background:#222; }
.profit { color:#0f0; font-weight:bold; }
.loss { color:red; font-weight:bold; }
@media(max-width:600px){ input, button { font-size:14px; padding:8px; } th, td { font-size:12px; padding:4px; } }
</style>
</head>

<body>
<header>GTA RP • Перекуп</header>
<div class="container">

<!-- Главный экран с кнопками -->
<div id="mainScreen" class="box" style="display:block;">
  <h3>Главное меню</h3>
  <button onclick="showCategory('Предметы')">Предметы</button>
  <button onclick="showCategory('Аренда')">Аренда</button>
  <button onclick="showCategory('Машины')">Машины</button>
  <button onclick="showCategory('Шмотки')">Шмотки</button>
  <button onclick="showBonus()">БонусКоинты</button>

  <p>Общий расход: <span id="totalBuy" class="loss">$0</span></p>
  <p>Общая прибыль: <span id="totalSell" class="profit">$0</span></p>
</div>

<!-- Раздел категории -->
<div id="categoryBox" class="box">
  <h3 id="categoryTitle"></h3>
  <input type="text" id="itemName" placeholder="Название">
  <input type="number" id="buy" placeholder="Покупка">
  <input type="number" id="sell" placeholder="Продажа">
  <button onclick="addDeal()">Добавить сделку</button>

  <table>
    <thead>
      <tr><th>Название</th><th>Покупка</th><th>Продажа</th><th>Прибыль</th><th>Удалить</th></tr>
    </thead>
    <tbody id="categoryTableBody"></tbody>
  </table>
  <button onclick="backToMain()">⬅ Назад</button>
</div>

<!-- Раздел бонускоинты -->
<div id="bonusBox" class="box">
  <h3>БонусКоинты</h3>
  <table>
    <thead>
      <tr><th>Наименование</th><th>Описание</th><th>Итог</th></tr>
    </thead>
    <tbody id="bonusTableBody">
      <tr><td>Бонус 1</td><td>Описание 1</td><td>100</td></tr>
      <tr><td>Бонус 2</td><td>Описание 2</td><td>200</td></tr>
    </tbody>
  </table>
  <button onclick="backToMain()">⬅ Назад</button>
</div>

</div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();

let deals = JSON.parse(localStorage.getItem('deals')) || [];
let currentCategory = '';

function showCategory(category){
  currentCategory = category;
  document.getElementById('mainScreen').style.display='none';
  document.getElementById('bonusBox').style.display='none';
  document.getElementById('categoryBox').style.display='block';
  document.getElementById('categoryTitle').textContent=category;
  renderCategoryTable();
}

function showBonus(){
  document.getElementById('mainScreen').style.display='none';
  document.getElementById('categoryBox').style.display='none';
  document.getElementById('bonusBox').style.display='block';
}

function backToMain(){
  document.getElementById('mainScreen').style.display='block';
  document.getElementById('categoryBox').style.display='none';
  document.getElementById('bonusBox').style.display='none';
  updateTotals();
}

function addDeal(){
  const name = document.getElementById('itemName').value;
  const buy = Number(document.getElementById('buy').value)||0;
  const sell = Number(document.getElementById('sell').value)||0;
  if(!name){ alert('Введите название'); return; }

  deals.push({category:currentCategory, name, buy, sell});
  localStorage.setItem('deals', JSON.stringify(deals));

  document.getElementById('itemName').value='';
  document.getElementById('buy').value='';
  document.getElementById('sell').value='';
  renderCategoryTable();
  updateTotals();
}

function deleteDeal(index){
  deals.splice(index,1);
  localStorage.setItem('deals', JSON.stringify(deals));
  renderCategoryTable();
  updateTotals();
}

function renderCategoryTable(){
  const tbody = document.getElementById('categoryTableBody');
  tbody.innerHTML='';
  deals.forEach((d,i)=>{
    if(d.category===currentCategory){
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${d.name}</td><td>${d.buy}</td><td>${d.sell}</td><td>${d.sell-d.buy}</td>
      <td><button onclick="deleteDeal(${i})">❌</button></td>`;
      tbody.appendChild(tr);
    }
  });
}

function updateTotals(){
  const totalBuy = deals.reduce((a,d)=>a+d.buy,0);
  const totalSell = deals.reduce((a,d)=>a+d.sell,0);
  document.getElementById('totalBuy').textContent='$'+totalBuy;
  document.getElementById('totalSell').textContent='$'+totalSell;
}

// Инициализация главного экрана
updateTotals();
</script>

</body>
</html>
